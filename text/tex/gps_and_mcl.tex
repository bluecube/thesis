\chapter{GPS and Monte Carlo Localization}
\label{chap:gps_and_mcl}

This chapter discusses two approaches to using GPS receiver as a correction input
to Monte Carlo localization. One based on pseudorange measurements and one based on
WGS84 pre-calculated data.



\section{Position Domain Integration}
Position domain integration means combining the calculated position and velocity from
GPS with other sensors.

Most GPS receivers 

This approach has the advantage of being very simple 

\begin{itemize}
\item Using complete fixes from receiver
\item Simple, less CPU intensive
\end{itemize}

\subsection{Sensor Model}

\begin{figure}[htp]
	\centering
	\input{img/wgs84_hdop_error.pdf_tex}
	\caption{Measurement errors vs. HDOP.}
	\label{fig:wgs84_hdop_error}

	% cube@duskwalker ~/diplomka/impl $ ./wgs84_errors.py recordings/month.recording2 --max-plot-hdop 6 --max-plot-error 25 --no-show --save-hdop-plot ../text/img/wgs84_hdop_error.svg 
	% /usr/lib/python2.7/site-packages/mpl_toolkits/__init__.py:2: UserWarning: Module argparse was already imported from /usr/lib/python2.7/argparse.pyc, but /usr/lib/python2.7/site-packages is being added to sys.path
	%   __import__('pkg_resources').declare_namespace(__name__)
	% 2012-08-02 09:25:10,025 - root - INFO - Retrieving fixes
	% 2012-08-02 10:22:03,807 - root - INFO - Done. Have 2363458 fixes
	% 2012-08-02 10:22:03,808 - root - INFO - Projecting
	% 2012-08-02 10:22:04,645 - root - INFO - Done
	% 2012-08-02 10:22:04,645 - root - INFO - Calculating distances
	% 2012-08-02 10:22:04,802 - root - INFO - Done
	% 2012-08-02 10:22:04,802 - root - INFO - HDOP statistics
	% Fitted polynomial: poly([ 21.61432911  11.82821964  -4.19552521   1.80325531])
	% Fitted Error(HDOP = 1): 5.22782179741
	% 2012-08-02 10:22:12,491 - root - INFO - Done
	% Scatter plots will only use 1/472 samples
	% 99.89% % is in the area 6.0x25.0
	% 2012-08-02 10:23:12,397 - root - INFO - Saved ../text/img/wgs84_hdop_error.svg
\end{figure}

For modelling the error we basically follow \cite{www-wilson}.

Distance between the real receiver position is modelled using Rayleigh distribution
parameterized with HDOP of the measurement:
\begin{equation}
	\Prob(\|\vect{p_\mathrm{R}} - \vect{p'_\mathrm{R}}\| < x \mid \HDOP) =
		1 - e^{-x^2/2\sigma(\HDOP)^2}
\end{equation}
Here \(\vect{p_\mathrm{R}}\) is the real receiver position and \(\vect{p'_\mathrm{R}}\)
the noisy reported position.

The parameter \(\sigma(\HDOP)\) of the Rayleigh distribution is chosen to make the
mean value of the distribution fit mean value of experimental data.
Theoretically, mean error should be equal to \(\HDOP\) times \(\UERE\) (see \ref{sec:gps-errors}),
but in practice it is not linear.
In figure \ref{fig:wgs84_hdop_error} green line shows fitting of the theoretical linear model,
red curve is the fitted polynomial \(\num{21.61432911}x^3 + \num{11.82821964}x^2 - 
\num{4.19552521}x + \num{1.80325531}\).
Measured data are represented by blue dots and yellow dots show the mean for each HDOP value.

TODO: Correlated!

\section{Measurement Domain Integration}
\label{sec:measurement_domain}
\begin{itemize}
\item Using each pseudorange measurement
\item Maybe better localization, no assumptions about vehicle properties
\end{itemize}

\subsection{Static Environment Assumption}
\label{sec:gps-mcl-static-env}
Monte Carlo Localization assumes that the environment is static, but we need to
localize according to moving satellites.
To avoid this problem we will hide satellite motion into the robot state and sensor model.

\subsection{Error distribution}
\begin{itemize}
\item Normal distribution (???)
\end{itemize}

\subsection{Preprocessing}
\begin{itemize}
\item ???
\end{itemize}

\subsection{Initial estimate}
\begin{itemize}
\item starting as position domain, later switching to measurement domain
\end{itemize}

\subsection{Simplifications}
\begin{itemize}
\item Ignoring altitude (???)
\item Additional 1D kalman for altitude (???)
\item Additional 1D kalman for receiver clock error (???)
\end{itemize}
