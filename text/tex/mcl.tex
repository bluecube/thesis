\chapter{Monte Carlo Localization}
\label{chap:mcl}

The following chapter defines the localization problem, provides quick overview
of several probabilistic localization algorithms and finally describes
Monte Carlo Localization algorithm.

\section{Localization}
Localization of a mobile robot is a task of estimating position (and possibly
also other state) of the robot based on performed actions and sensor readings.

Localization can mean either position tracking, where the robot knows its initial
position and the task is only to update the estimate and handle relatively small
errors, or global localization, where the robot has to find its position from scratch.

\begin{itemize}
\item ...
\end{itemize}

\section{Markov Localization}

\begin{itemize}
\item \cite{fox98,diard}
\item recursive probabilistic algorithm that estimates state of the robot based
	on its actions and measured sensor data.
\item \(X_i\) is the random variable representing robot's state,
	\(m_i\) is the sensory input in time step \(i\) and \(a_i\) is the action the
	robot performs in the time step \(i\), after it measures the values \(m_i\).
\item Assumes independence of actions
	\begin{equation}
		P(X_i = x | X_1, \dotsc, X_{i - 1}, a_1, \dotsc, a_{i - 1},
		m_1, \dotsc, m_{i - 1}) = 
		P(X_i = x | X_{i - 1}, a_{i - 1})
	\end{equation}
\item Assumes independence of measurements
	\begin{equation}
		P(m_i | X_1, \dotsc, X_i, a_1, \dotsc, a_{i - 1},
		m_1, \dotsc, m_{i - 1}) = 
		P(m_i | X_i)
	\end{equation}
\item Prediction:
Using action model \(P(X_i = x | X_{i-1} = x^\prime, a_{i - 1})\) to predict
current position based on past state and action
	\begin{equation}
		\label{eq:markov-prediction}
		P(X_i = x | X_{i - 1}, a_{i - 1}) =
		\int
		P(X_i = x | X_{i - 1} = x', a_{i - 1})
		P(X_{i - 1} = x^\prime | m_{i - 1}, a_{i - 2})
		\mathrm{d}x'
	\end{equation}

\item Correction:
Using sensor model \(P(m_i | X_i = x)\) to correct the estimate from prediction phase
and form a final state estimate for time frame \(i\).
	\begin{equation}
	\label{eq:markov-correction}
	P(X_i = x | X_{i-1}. m_i, a_{i - 1}) =
		\frac
			{P(m_i | X_i = x) P(X_i = x | X_{i - 1}, a_{i - 1})}
			{
			\int
			P(m_i | X_i = x') P(X_i = x' | X_{i - 1}, a_{i - 1})
			\mathrm{d}x'
			}
	\end{equation}
	Note that the denominator in \eqref{eq:markov-correction} is only a normalizer to
	keep probabilities of all positions to sum to \(1\). 
\item Several specialisations of Markov localization exists differing mainly in how the
	current state estimation is represented.
	Examples include Kalman filters, that represent the estimation as Gaussian,
	%(together with other assumptions, see \ref{sec:kalman}),
	grid based algorithms \cite{fox98}, or Monte Carlo localization
	that is described in section \ref{sec:mcl-algorithm}.
\end{itemize}

%\begin{compactitem}
%\item Prediction phase updates the belief from the previous time step based
%on the actions performed by the robot.
%\item Correction phase then updates the belief based on sensor measurements.
%\end{compactitem}


\subsection{Kalman Filters}
\label{sec:kalman}

\begin{itemize}
\item \cite{kalman60,welch95}
\item popular
\item efficient
\item Can be viewed as a closed form solution of Markov localization where both the
	action model and measurement model are linear and Gaussian.

	\begin{equation}
	\label{eq:kalman-action-model}
	P(X_i = x | X_{i-1} = x', a_{i - 1}) \sim N(A_{i - 1}x' + B_{i - 1}a_{i - 1}, Q_{i - 1})
	\end{equation}
	\begin{equation}
	\label{eq:kalman-measurement-model}
	P(m_{i} | X_i = x) \sim N(H_{i}x_{i}, R_i)
	\end{equation}
	
	In equations \eqref{eq:kalman-action-model} and \eqref{eq:kalman-measurement-model}
	the matrix \(A_i\) describes change of state if there was no control input and no noise,
	matrix \(B_i\) contains the influence of action \(a_i\) and \(H_i\) relates state to measured
	values.
	\(Q_i\) and \(R_i\) are covariance matrices of action model and measurement model.

\item Non linear motion and measurement models can be approximated 
	using a first order Taylor expansion to form extended Kalman
	filter (EKF) \cite{welch95}.
\end{itemize}

\section{MCL Algorithm}
\label{sec:mcl-algorithm}

\cite{dellaert99}

\subsection{Prediction}
\subsection{Correction}
\subsection{Normalization}
\subsection{Resampling}
